<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCM - VISOR SUPREMO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --tg-bg: #1c2733; 
            --tg-panel: #17212b; --tg-blue: #2481cc; 
            --tg-green: #45ad5b; --tg-red: #d14e4e; --tg-text: #f5f5f5;
        }
        body { background: #070a0e; color: var(--tg-text); font-family: 'Open Sans', sans-serif; display: flex; justify-content: center; margin: 0; height: 100vh; overflow: hidden; }
        #app { width: 100%; max-width: 400px; height: 100vh; background: var(--tg-bg); display: flex; flex-direction: column; position: relative; }
        
        /* Cabe√ßalho */
        #header { background: var(--tg-panel); padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #101921; }
        .stats-box { display: flex; gap: 15px; font-weight: bold; font-size: 14px; }
        .win { color: var(--tg-green); }
        .loss { color: var(--tg-red); }

        /* Chat */
        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-size: cover; }
        .bubble { max-width: 85%; padding: 10px; border-radius: 12px; background: var(--tg-panel); position: relative; font-size: 14px; line-height: 1.5; align-self: flex-start; box-shadow: 0 2px 5px rgba(0,0,0,0.2); white-space: pre-wrap; }
        .bubble.ENTRADA { border-left: 4px solid var(--tg-blue); }
        .bubble.WIN { border-left: 4px solid var(--tg-green); animation: pulse-green 1s infinite; }
        .bubble.LOSS { border-left: 4px solid var(--tg-red); }
        
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0px rgba(69, 173, 91, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(69, 173, 91, 0); } 100% { box-shadow: 0 0 0 0px rgba(69, 173, 91, 0); } }

        /* Timer */
        #timer-box { position: absolute; top: 70px; right: 15px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 20px; font-size: 12px; color: #fff; z-index: 10; border: 1px solid var(--tg-blue); }

        .msg-time { display: block; font-size: 10px; color: #818d99; text-align: right; margin-top: 5px; }
    </style>
</head>
<body>

<div id="app">
    <div id="header">
        <div><b>KCM MASTER</b> <small style="color: var(--tg-blue);">LIVE</small></div>
        <div class="stats-box">
            <span class="win">‚úÖ <span id="w-count">0</span></span>
            <span class="loss">‚ùå <span id="l-count">0</span></span>
        </div>
    </div>

    <div id="timer-box">Aguardando...</div>

    <div id="chat">
        <div class="bubble">ü§ñ Bem-vindo ao Sistema KCM!<br>Aguardando sinais do mercado...</div>
    </div>
</div>

<script>
    // --- IMPORTANTE: TROQUE PELO LINK DO SEU RENDER ---
    const URL_RENDER = "https://SEU-PROJETO.onrender.com"; 
    const socket = io(URL_RENDER);

    let wins = 0;
    let reds = 0;

    // Sons
    const somAlerta = new Audio('https://www.myinstants.com/media/sounds/notification.mp3');
    const somWin = new Audio('https://www.myinstants.com/media/sounds/tada.mp3');

    socket.on('connect', () => {
        console.log("Conectado ao servidor!");
        addMsg("üì° Conex√£o estabelecida com o servidor Render.");
    });

    socket.on('sinal_app', (data) => {
        console.log("Sinal recebido:", data);
        
        if (data.tipo === 'ENTRADA') {
            somAlerta.play();
            addMsg(data.texto, 'ENTRADA');
        } 
        else if (data.tipo === 'RESULTADO') {
            if (data.resultado === 'WIN') {
                wins++;
                somWin.play();
                document.getElementById('w-count').innerText = wins;
                addMsg(data.texto, 'WIN');
            } else {
                reds++;
                document.getElementById('l-count').innerText = reds;
                addMsg(data.texto, 'LOSS');
            }
        }
    });

    function addMsg(txt, type = '') {
        const chat = document.getElementById('chat');
        const div = document.createElement('div');
        div.className = `bubble ${type}`;
        const time = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        div.innerHTML = `${txt}<span class="msg-time">${time}</span>`;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    // Timer de 60 segundos apenas visual
    setInterval(() => {
        const s = new Date().getSeconds();
        document.getElementById('timer-box').innerText = "Pr√≥xima vela em: " + (60 - s) + "s";
    }, 1000);
</script>

</body>
</html>
